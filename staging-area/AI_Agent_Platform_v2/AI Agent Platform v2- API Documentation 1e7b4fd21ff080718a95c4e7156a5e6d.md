# AI Agent Platform v2- API Documentation

# **AI Agent Platform - API Documentation**

## **1. Overview**

This document provides the **API specification** for interacting with the **Alfred Agent Platform**, including the core API for managing tasks and agent interactions. The system follows an event-driven architecture using **Pub/Sub** and **Supabase** for state management. All communication between agents and services is done using the **A2A task envelope schema**, ensuring loose coupling and scalability.

---

## **2. A2A Envelope Schema**

All tasks, messages, and events follow the **A2A envelope schema**. This schema defines the structure of messages published on Pub/Sub topics, ensuring consistency in task creation, processing, and completion.

### **A2A Task Envelope (JSON)**

```json
json
CopyEdit
{
  "schema_version": "0.4",
  "task_id": "uuid",
  "intent": "TREND_ANALYSIS",
  "role": "assistant",
  "content": {
    "data": "task-specific data"
  },
  "trace_id": "uuid",
  "timestamp": "2025-05-02T12:34Z"
}

```

### **Envelope Fields**:

- **`schema_version`**: The version of the schema used (e.g., "0.4").
- **`task_id`**: A unique identifier for the task (UUID format).
- **`intent`**: The type of task (e.g., `TREND_ANALYSIS`, `COMPLIANCE_UPDATE`).
- **`role`**: The role of the agent (e.g., `assistant`, `monitor`).
- **`content`**: Task-specific data and additional information.
- **`trace_id`**: A unique identifier to trace the task across the system.
- **`timestamp`**: The time the task was created, in ISO 8601 format.

---

## **3. Task Management API**

The **Task Management API** allows you to create, manage, and track tasks. It provides endpoints for initiating tasks, checking status, and retrieving results.

### **3.1. Task Creation**

### **POST** `/tasks/create`

Creates a new task in the system and publishes it to the **Pub/Sub** broker.

**Request Body**:

```json
json
CopyEdit
{
  "intent": "TREND_ANALYSIS",
  "role": "assistant",
  "content": {
    "data": "Data to be analyzed"
  },
  "trace_id": "trace-uuid"
}

```

**Response**:

- **200 OK**: Task successfully created and published.
- **400 Bad Request**: Invalid task data.

**Example Response**:

```json
json
CopyEdit
{
  "task_id": "uuid",
  "message": "Task created successfully"
}

```

---

### **3.2. Task Status**

### **GET** `/tasks/{task_id}/status`

Retrieves the status of a task, including whether it is still processing, completed, or failed.

**URL Parameters**:

- **`task_id`**: The unique identifier of the task.

**Response**:

```json
json
CopyEdit
{
  "task_id": "uuid",
  "status": "completed",
  "result": "Task result data",
  "timestamp": "2025-05-02T12:34Z"
}

```

Possible values for **`status`**:

- `processing`: Task is currently being processed.
- `completed`: Task is finished, and results are available.
- `failed`: Task failed during processing.

---

### **3.3. Task Results**

### **GET** `/tasks/{task_id}/results`

Retrieves the results of a completed task. The results will contain task-specific data, including outputs generated by agents.

**URL Parameters**:

- **`task_id`**: The unique identifier of the task.

**Response**:

```json
json
CopyEdit
{
  "task_id": "uuid",
  "result": {
    "data": "Task output data here"
  },
  "timestamp": "2025-05-02T12:34Z"
}

```

---

## **4. Pub/Sub API Integration**

Agents communicate via **Pub/Sub**, sending and receiving task-related events. The following APIs provide integrations with **Google Cloud Pub/Sub** for task management and notifications.

### **4.1. Publish Task to Pub/Sub**

### **POST** `/pubsub/publish`

Publishes a message to the **Pub/Sub** topic for task creation or completion.

**Request Body**:

```json
json
CopyEdit
{
  "topic": "a2a.tasks.create",
  "message": {
    "schema_version": "0.4",
    "task_id": "uuid",
    "intent": "TREND_ANALYSIS",
    "role": "assistant",
    "content": {
      "data": "Data to be analyzed"
    },
    "trace_id": "trace-uuid",
    "timestamp": "2025-05-02T12:34Z"
  }
}

```

**Response**:

- **200 OK**: Message successfully published to the Pub/Sub topic.
- **400 Bad Request**: Invalid message format.

---

### **4.2. Subscribe to Pub/Sub Topics**

### **POST** `/pubsub/subscribe`

Subscribes to a Pub/Sub topic for receiving task updates.

**Request Body**:

```json
json
CopyEdit
{
  "topic": "a2a.tasks.create",
  "subscription": "agent-subscription"
}

```

**Response**:

- **200 OK**: Successfully subscribed to the topic.
- **400 Bad Request**: Invalid subscription request.

---

## **5. Real-Time Updates with Supabase Realtime**

Supabase provides **real-time** updates for task progress and notifications. The following API allows agents and frontend applications to receive real-time updates about task states.

### **5.1. Subscribe to Task Updates**

### **GET** `/realtime/subscribe`

Subscribes to a real-time stream of task updates (e.g., status changes, results) via **WebSockets**.

**URL Parameters**:

- **`task_id`**: The task ID to listen for updates on.

**Example Response**:

```json
json
CopyEdit
{
  "task_id": "uuid",
  "status": "processing",
  "timestamp": "2025-05-02T12:34Z"
}

```

---

### **5.2. Real-Time Task Updates (WebSocket)**

The **WebSocket** connection provides continuous updates for task status.

**Example WebSocket Payload**:

```json
json
CopyEdit
{
  "task_id": "uuid",
  "status": "completed",
  "result": "Task result data",
  "timestamp": "2025-05-02T12:34Z"
}

```

---

### **5.3. Health Check API**

## GET /health

Returns the service's health status.

Response:
{
    "status": "healthy",
    "version": "2.1.0",
    "uptime": 3600
}

### GET /ready

Returns the service's readiness for traffic.

Response:
{
    "ready": true,
    "dependencies": {
        "database": "connected",
        "pubsub": "connected"
    }
}

## **6. Authentication & Authorization**

The platform uses **OAuth 2.0** for secure authorization between agents and services. This is integrated with **Supabase Auth** or **Firebase Auth** for user authentication.

- **OAuth 2.0** for agent-to-agent communications and user access control.
- **JWT** tokens are issued for secure API access.

---

## **7. Error Handling & Response Codes**

- **200 OK**: The request was successfully processed.
- **400 Bad Request**: Invalid or malformed request data.
- **401 Unauthorized**: Missing or invalid authentication credentials.
- **404 Not Found**: The requested resource was not found.
- **500 Internal Server Error**: General server error, retry or contact support.

---

## **8. Rate Limiting & Throttling**

To ensure the platform remains responsive, API requests will be subject to rate limiting.

- **Maximum Requests**: Each user or service can make a maximum of **100 requests per minute**.
- **Retry-After**: In case of rate limiting, a **Retry-After** header will be sent with the appropriate wait time before retrying.

---

## **9. Example Use Case Flow**

1. **Initiate Task (Slack)**:
    - The user sends a command to **Alfred** (Slack bot).
    - Alfred publishes a task to `a2a.tasks.create`.
2. **Task Execution**:
    - **SocialIntelligenceAgent** subscribes to `a2a.tasks.create` and processes the task.
    - The agent uses **LangChain** to scrape data, cluster, and summarize it.
3. **Task Completion**:
    - The agent publishes the results to `a2a.tasks.completed`.
    - The frontend application subscribes to task updates via Supabase **Realtime** and updates the user interface with the task result.

---

## **10. Conclusion**

The **Alfred Agent Platform** API allows seamless integration of agents, messaging, and state management. The core functionality revolves around managing tasks with standardized **A2A envelopes** and using **Pub/Sub** for event-driven communication. The platform also supports real-time task updates via **Supabase Realtime**, ensuring a responsive and scalable system.

Let me know if you'd like to expand on any specific part of the API or if you need further modifications to this document!