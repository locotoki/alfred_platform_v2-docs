# RAG Service – JSON Schemas (v1)

# RAG Service – JSON Schemas (v1)

> Version : aligned with RFC draft dated 2025‑05‑09 – section 7.
> 

## 1. RetrievalRequest.schema.json

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/rag/RetrievalRequest.schema.json",
  "title": "RetrievalRequest",
  "type": "object",
  "required": [
    "trace_id",
    "tenant_id",
    "query",
    "top_k"
  ],
  "properties": {
    "trace_id": {
      "type": "string",
      "format": "uuid",
      "description": "W3C Trace Context UUID v7 generated by caller"
    },
    "tenant_id": {
      "type": "string",
      "description": "Tenant or user namespace key e.g. org‑123 or user‑456"
    },
    "persona": {
      "type": "string",
      "enum": ["personal", "business"],
      "description": "Persona context – governs namespace selection"
    },
    "query": {
      "type": "string",
      "maxLength": 4096
    },
    "top_k": {
      "type": "integer",
      "minimum": 1,
      "maximum": 50,
      "default": 5
    },
    "filters": {
      "type": "object",
      "description": "Arbitrary metadata filters (key → exact‑match or list)",
      "additionalProperties": {
        "oneOf": [
          {"type": "string"},
          {
            "type": "array",
            "items": {"type": "string"},
            "minItems": 1,
            "uniqueItems": true
          }
        ]
      }
    },
    "quality": {
      "type": "string",
      "enum": ["standard", "high"],
      "default": "standard",
      "description": "High triggers OpenAI reranker path"
    }
  }
}

```

## 2. RetrievalResponse.schema.json

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/rag/RetrievalResponse.schema.json",
  "title": "RetrievalResponse",
  "type": "object",
  "required": [
    "trace_id",
    "latency_ms",
    "hits"
  ],
  "properties": {
    "trace_id": {
      "type": "string",
      "format": "uuid"
    },
    "latency_ms": {
      "type": "integer",
      "minimum": 0
    },
    "hybrid": {
      "type": "string",
      "enum": ["bm25+ann", "ann"],
      "description": "Hybrid search strategy used"
    },
    "rerank_model": {
      "type": "string",
      "description": "Identifier of reranker model (e.g., bge-base, gpt-4o)"
    },
    "hits": {
      "type": "array",
      "items": {
        "$ref": "https://example.com/rag/SourceDocument.schema.json"
      }
    }
  }
}

```

## 3. SourceDocument.schema.json

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/rag/SourceDocument.schema.json",
  "title": "SourceDocument",
  "type": "object",
  "required": ["id", "score", "chunk_text"],
  "properties": {
    "id": {
      "type": "string"
    },
    "score": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "chunk_text": {
      "type": "string",
      "maxLength": 1024,
      "description": "Raw text of the chunk (may be partially redacted)"
    },
    "source_uri": {
      "type": "string",
      "format": "uri"
    },
    "metadata": {
      "type": "object",
      "additionalProperties": {"type": "string"}
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "tenant_id": {
      "type": "string",
      "description": "Namespace ownership – duplicated from Request for audit"
    }
  }
}

```

---

### Usage Notes

- **Versioning**: all schemas start at `v1alpha`. Breaking changes will bump minor version; compatible additions bump patch.
- **$id fields**: replace `example.com` with your internal schema registry host.
- **Bundled distribution**: These three JSON files live in `contracts/rag/` and are referenced by Gateway and SDK codegen.

---

*Inline review welcome – next step is to auto‑generate TypeScript & Python types via `quicktype` or `datamodel-codegen`.*